/**
 * @file Firestore Security Rules
 * @description This ruleset is in "Prototyping Mode," focusing on strong authentication and authorization while relaxing data validation to enable rapid iteration.
 *
 * Core Philosophy:
 *  - Authenticated Access: Any authenticated user (including anonymous) can read and write to the necessary collections for the app to function. This is suitable for prototyping.
 *  - Future Proofing: While open now, the rules are structured to easily add ownership and role-based checks in the future.
 *
 * Data Structure:
 *  - /menuItems/{menuItemId}: Contains menu item data.
 *  - /orders/{orderId}: Contains order information.
 *
 * Key Security Decisions:
 *  - Public read on `menuItems` allows anyone to browse the menu. Writes are restricted to authenticated users.
 *  - `orders` are fully accessible by any authenticated user, which is necessary for the kitchen and main ordering views to function in this prototype.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if the user is signed in.
    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Allows anyone to read menu items, but restricts creation, updates, and deletion to authenticated users.
     */
    match /menuItems/{menuItemId} {
      allow get: if true;
      allow list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user full access to create, read, update, and delete orders.
     * This is required for the kitchen and order tracking views to function correctly.
     */
    match /orders/{orderId} {
      allow read, write: if isSignedIn();
    }
  }
}
